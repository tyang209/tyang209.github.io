<!DOCTYPE html>
<html lang="en">

<head>
  
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap/3/css/bootstrap.css" />


    <!-- Latest compiled and minified CSS -->
    

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>      
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/dc/2.0.2/dc.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">        


    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js" charset="utf-8"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/dc/2.0.2/dc.js" charset="utf-8"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/dc/2.0.2/dc.min.js" charset="utf-8"></script>

    <style>
      .sketchGrid{
        display: table;
        margin:auto;
      }
    </style>


</head>
<body>
	<h1>Maude Night App</h1>
        <div class="container" style="width:100%">
            <div class="row">
                <div class="col-md-4">
                    <h4>Teams</h4>
                    <select id="teamMenu" class="selectpicker"  data-live-search="true">                
                    </select>
                </div> 
            </div>
        </div>  
  <div class="container-fluid">
	<div id="dc-data-grid"></div>
</div>

</body>

<script>
var videoGrid = dc.dataGrid('#dc-data-grid');

function getYoutubeID(url) {
    var id = url.match("[\\?&]v=([^&#]*)");
    id = id[1];
    return id;
};


d3.csv("Maude.csv", function(data){
      if(error) { console.log(error); }

  var activeTeams = ['Pretty_Boys','Choir','Archnemesis',
                    'The_Foundation','Cha-Cha','Bundt'
                    ,'A_Few_Sandwich_Lovers','The_Classic']

  var randomActiveTeam = activeTeams[Math.floor(Math.random()*activeTeams.length)]


  function makeTeamPicker(){
    d3.select("#teamMenu").selectAll("option")
    .data(d3.map(data, function(d){return d.team;}).keys())
    .enter()
    .append("option")
    .text(function(d){return d.replace(/_/g, ' ');})
    .attr("value",function(d){return d;});
    $('#teamMenu').selectpicker('refresh');
    $('#teamMenu').selectpicker('val',randomActiveTeam);

    d3.select('#teamMenu').on("change", function(){
      team = d3.select(this).property('value');
      teamDim.filter(null);
      teamDim.filter(team);
      dc.renderAll();
    })

  }

  
	var ndx = crossfilter(data);
	var teamDim =  ndx.dimension(function (d){
		return d.team
	});

    var writerDim = ndx.dimension(function (d) {
        return d.writer;
    });

    teamDim.filter(randomActiveTeam)

  videoGrid
  	.dimension(teamDim)
  	.group(function(d){return d.team.replace(/_/g,' ');})
  	.html(function (d){
            up_date = String(d.upload_date.slice(0,4)) +"-"+ d.upload_date.slice(4,6) + "-"+d.upload_date.slice(6)
            return "<div class='row sketchGrid'><div class='col-lg-8 col-lg-offset-6'> <h3 class='title'>"+d.sketch_title+"</h3><p class='writer'>Written By: " + d.writer + " - Uploaded "+up_date+"</p><div class='youtube' style='background-color:red; width:560px; height:315px;' data-link='"+d.link+"'></div></div></div>"})
          // return "<div class='sketchGrid' style='background-color:red; width:560px; height:315px; margin:10px'> <a href='"+d.link + "'class='youtube'></div>"})
  	.size(data.length)
    .on('postRender',function(table){
        $('.youtube').each(function() {
            var id = getYoutubeID( $(this).data('link') );
            this.id = id;
            var thumb_url = "http://img.youtube.com/vi/"+id+"/maxresdefault.jpg";
            $('<img width="100%" src="'+thumb_url+'" />').appendTo($(this));
        }); 
        $('.youtube').on('click', function() {
          ytid = getYoutubeID($(this).data('link'));
          $(this).html("<iframe width='560' height='315' src='//www.youtube.com/embed/"+ytid+"?autoplay=1"+" frameborder='0' allowfullscreen></iframe>").css('background', 'none');
});


    });
  makeTeamPicker();
  
  dc.renderAll();

});


</script>


</html>